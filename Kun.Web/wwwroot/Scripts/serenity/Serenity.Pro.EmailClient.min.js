var Serenity;(function(e){var t;(function(e){e.folderIcons={inbox:"fa-inbox",sent:"fa-envelope-o",drafts:"fa-file-text-o",junk:"fa-filter",trash:"fa-trash-o"};function t(t){return"fa "+(e.folderIcons[t.Kind]||"fa-folder-o")}function a(e){return Q.tryGetText("Site.EmailClient.FolderNames."+e.Kind)||e.Name||e.FullName||""}e.mailboxFolderName=a;var n=function(e){__extends(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}n.prototype.render=function(){var e=this;return React.createElement("li",null,React.createElement("a",{href:"#folder/"+encodeURIComponent(this.props.folder.FullName),className:this.props.folder.FullName==this.props.activeFolder?"active":""},React.createElement("i",{className:t(this.props.folder)})," ",React.createElement("span",null,a(this.props.folder),this.props.folder.UnreadCount>0&&React.createElement("span",{className:"label label-primary pull-right"},this.props.folder.UnreadCount))),this.props.folder.SubFolders&&React.createElement("ul",null,this.props.folder.SubFolders.map(function(t){return React.createElement(n,{folder:t,activeFolder:e.props.activeFolder,key:t.FullName})})))};return n}(React.Component);e.MailboxFolderLink=n})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e){var t="";for(var a=0;a<e.FullName.split(".").length-1;a++)t+="    ";return t}e.mailboxFolderSelectPadding=t;var a=function(a){__extends(n,a);function n(){return a!==null&&a.apply(this,arguments)||this}n.prototype.handleMoveToFolder=function(e){e.target.value&&this.props.onMoveToFolder(e.target.value);e.target.value=""};n.prototype.render=function(){var a=this;return React.createElement("div",{className:"mailbox-controls"},React.createElement("button",{type:"button",className:"btn btn-default btn-sm checkbox-toggle",onClick:function(e){return a.props.onCheckAll()}},React.createElement("i",{className:this.props.allChecked?"fa fa-check-square-o":"fa fa-square-o"}))," ",React.createElement("div",{className:"btn-group"},React.createElement("button",{type:"button",className:"btn btn-default btn-sm",onClick:function(e){return a.props.onToggleSeen()},title:Q.text("Site.EmailClient.ToggleReadButton")},React.createElement("i",{className:"fa fa-star-o"})),React.createElement("button",{type:"button",className:"btn btn-default btn-sm",onClick:function(e){return a.props.onDelete()},title:Q.text("Site.EmailClient.DeleteButton")},React.createElement("i",{className:"fa fa-trash-o"})),React.createElement("button",{type:"button",className:"btn btn-default btn-sm",onClick:function(e){return a.props.onRefresh()},title:Q.text("Site.EmailClient.RefreshButton")},React.createElement("i",{className:"fa fa-refresh"}))," ",React.createElement("select",{style:{padding:"4px",margin:"0 4px"},onChange:function(e){return a.handleMoveToFolder(e)}},React.createElement("option",{value:""},Q.text("Site.EmailClient.MoveToFolder")),this.props.flatFolderList.filter(function(e){return e.FullName!=a.props.folder}).map(function(a){return React.createElement("option",{key:a.FullName,value:a.FullName},t(a)+e.mailboxFolderName(a))}))),React.createElement("div",{className:"pull-right"},React.createElement("span",null,this.props.page*this.props.pageSize+1),"-",React.createElement("span",null,Math.min(this.props.page*this.props.pageSize+this.props.pageSize,this.props.messageCount)),React.createElement("span",null," / "),React.createElement("span",null,this.props.messageCount)," ",React.createElement("div",{className:"btn-group"},React.createElement("button",{type:"button",className:"btn btn-default btn-sm",onClick:function(e){return a.props.onChangePage(a.props.page-1)}},React.createElement("i",{className:"fa fa-chevron-left"})),React.createElement("button",{type:"button",className:"btn btn-default btn-sm",onClick:function(e){return a.props.onChangePage(a.props.page+1)}},React.createElement("i",{className:"fa fa-chevron-right"})))))};return n}(React.Component);e.MailboxToolbar=a})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t;(function(e){})(t=e.EmailService||(e.EmailService={}))})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var a=e.UI;var n=[{value:"custom",text:"Custom",settings:{ImapHost:"",ImapPort:993,ImapUsername:"",SmtpHost:"",SmtpPort:465,SmtpUsername:""}},{value:"gmail",text:"Gmail",settings:{ImapHost:"imap.gmail.com",ImapPort:993,ImapUsername:"yourusername@gmail.com",SmtpHost:"smtp.gmail.com",SmtpPort:465,SmtpUsername:"yourusername@gmail.com"}},{value:"outlook",text:"Outlook / Hotmail",settings:{ImapHost:"imap-mail.outlook.com",ImapPort:993,ImapUsername:"yourusername@outlook.com",SmtpHost:"smtp-mail.outlook.com",SmtpPort:587,SmtpUsername:"yourusername@outlook.com"}},{value:"yandex",text:"Yandex",settings:{ImapHost:"imap.yandex.com",ImapPort:993,ImapUsername:"yourusername@yandex.com",SmtpHost:"smtp.yandex.com",SmtpPort:465,SmtpUsername:"yourusername@yandex.com"}}];var r=function(){function e(){}return e}();t.MailboxLoginProps=r;var o=function(r){__extends(o,r);function o(){var e=r!==null&&r.apply(this,arguments)||this;e.editorRefs=new a.EditorRefs;e.handleQuickSettingChange=function(t){e.loadQuickSettings(t.target.value)};return e}o.prototype.loadQuickSettings=function(e){var t=Q.tryFirst(n,function(t){return t.value==e});if(t)this.editorRefs.loadFrom(t.settings,Object.keys(t.settings))};o.prototype.componentDidMount=function(){this.loadQuickSettings("gmail")};o.prototype.login=function(){var e=this;var a={};this.editorRefs.saveTo(a);delete a["QuickSettings"];t.EmailService.Login({LoginInfo:a},function(t){e.props.onLogin()})};o.prototype.render=function(){var t=this;var r=function(e){return Q.text("Site.EmailClient."+e)};var o=function(e){return{name:e,caption:r(e),setRef:t.editorRefs.set}};return React.createElement("div",{className:"s-MailboxLoginView"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-4"}),React.createElement("div",{className:"col-md-4"},React.createElement(a.Form,{ref:function(e){return t.form=e}},React.createElement("div",{className:"box box-solid login-view-box"},React.createElement("div",{className:"box-header with-border"},React.createElement("h3",{className:"box-title"},Q.text("Site.EmailClient.LoginTitle"))),React.createElement("div",{className:"box-body"},React.createElement(a.PropertyGrid,null,React.createElement(a.Field,{name:"QuickSettings",caption:r("QuickSettings"),editor:function(e){return React.createElement("select",{name:e.name,ref:e.ref,defaultValue:"gmail",onChange:t.handleQuickSettingChange},n.map(function(e){return React.createElement("option",{key:e.value,value:e.value},e.text)}))}}),React.createElement(a.Field,__assign({},o("ImapHost"),{required:true,editor:function(t){return React.createElement(e.StringEditor,__assign({},t))}})),React.createElement(a.Field,__assign({},o("ImapPort"),{required:true,editor:function(t){return React.createElement(e.IntegerEditor,__assign({},t))}})),React.createElement(a.Field,__assign({},o("ImapUsername"),{required:true,editor:function(a){return React.createElement(e.StringEditor,__assign({},a,{onChange:function(e){return t.editorRefs.get("SmtpUsername").value=t.editorRefs.get("ImapUsername").value}}))}})),React.createElement(a.Field,__assign({},o("ImapPassword"),{required:true,editor:function(a){return React.createElement(e.PasswordEditor,__assign({},a,{onChange:function(e){return t.editorRefs.get("SmtpPassword").value=t.editorRefs.get("ImapPassword").value}}))}})),React.createElement(a.Field,__assign({},o("SmtpHost"),{required:true,editor:function(t){return React.createElement(e.StringEditor,__assign({},t))}})),React.createElement(a.Field,__assign({},o("SmtpPort"),{required:true,editor:function(t){return React.createElement(e.IntegerEditor,__assign({},t))}})),React.createElement(a.Field,__assign({},o("SmtpUsername"),{required:true,editor:function(t){return React.createElement(e.StringEditor,__assign({},t))}})),React.createElement(a.Field,__assign({},o("SmtpPassword"),{required:true,editor:function(t){return React.createElement(e.PasswordEditor,__assign({},t))}})))),React.createElement("div",{className:"box-footer",style:{marginBottom:"10px"}},React.createElement("button",{className:"btn btn-success",onClick:function(e){return t.form.validateForm()&&t.login()},type:"button"},Q.text("Site.EmailClient.LoginButton")))))),React.createElement("div",{className:"col-md-4"})))};return o}(React.Component);t.MailboxLoginView=o})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.updateContents=function(){var e=this.iframe.contentDocument;e.open();e.write(this.props.contents||"");e.close();var t=this.iframe;$(t.contentDocument.body).removeAttr("oncontextmenu");t.style.height=Math.max(250,t.contentWindow.document.body.scrollHeight+30)+"px"};t.prototype.componentDidMount=function(){this.updateContents()};t.prototype.componentWillReceiveProps=function(e){if(e.contents!==this.props.contents)this.updateContents()};t.prototype.render=function(){var e=this;var t=this.props,a=t.contents,n=__rest(t,["contents"]);return React.createElement("iframe",__assign({ref:function(t){return e.iframe=t}},n))};return t}(React.Component);e.HtmlIFrame=t})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(t){__extends(a,t);function a(e){var a=t.call(this,e)||this;a.state={message:{}};return a}a.prototype.componentDidMount=function(){this.load()};a.prototype.componentWillReceiveProps=function(e){if(e.folder!==this.props.folder||e.uid!==this.props.uid)this.load()};a.prototype.back=function(){Q.Router.navigate("folder/"+encodeURIComponent(this.props.folder),true)};a.prototype.loadMessage=function(t,a){var n=this;return e.EmailService.RetrieveMessage({Folder:t,UniqueId:a},function(e){n.setState({message:e.Entity})})};a.prototype.load=function(){var e=this;clearTimeout(this.loadTimeout);this.loadTimeout=setTimeout(function(){if(e.props.folder&&e.props.uid!=null)e.loadMessage(e.props.folder,e.props.uid);else{e.setState({message:{}})}},500)};a.prototype.deleteMessage=function(){var t=this;Q.confirm(Q.text("Site.EmailClient.DeleteMessageConfirmation"),function(){e.EmailService.DeleteMessages({Folder:t.props.folder,UniqueIds:[t.props.uid]},function(e){Q.notifyInfo("Site.EmailClient.DeleteMessageSuccess");t.props.onClose();t.back()})})};a.prototype.moveToFolder=function(t){var a=this;if(!t)return;e.EmailService.Move({SourceFolder:this.props.folder,UniqueIds:[this.props.uid],TargetFolder:t},function(e){Q.notifySuccess("Site.EmailClient.MoveMessageSuccess");a.props.onClose();a.back()})};a.prototype.getDateText=function(){return Q.formatDate(this.state.message.Date,"dd.MM.yyyy HH:mm")};a.prototype.reply=function(t,a){e.EmailService.Reply({Folder:this.props.folder,UniqueId:this.props.uid,ReplyToAll:t,Forward:a},function(t){var a=new e.EmailComposeDialog;a.reply=t;a.dialogOpen()})};a.prototype.render=function(){var t=this;var a=!!this.state.message.UniqueId;return React.createElement("div",{className:"s-MailViewer"},React.createElement("div",{className:"mail-actions"},React.createElement("button",{type:"button",className:"btn btn-warning btn-sm",onClick:function(e){return t.back()}},"  ",React.createElement("i",{className:"fa fa-arrow-left"})," ",Q.text("Site.EmailClient.BackButton"),"  ")," ",a&&React.createElement("button",{type:"button",className:"btn btn-primary btn-sm",onClick:function(e){return t.reply()}},React.createElement("i",{className:"fa fa-mail-reply"})," ",Q.text("Site.EmailClient.ReplyButton"))," ",a&&React.createElement("button",{type:"button",className:"btn btn-default btn-sm",onClick:function(e){return t.reply(true)}},React.createElement("i",{className:"fa fa-mail-reply-all"})," ",Q.text("Site.EmailClient.ReplyAllButton"))," ",a&&React.createElement("button",{type:"button",className:"btn btn-default btn-sm",onClick:function(e){return t.reply(false,true)}},React.createElement("i",{className:"fa fa-mail-forward"})," ",Q.text("Site.EmailClient.ForwardButton"))," ",a&&React.createElement("select",{style:{padding:"4px",position:"relative",top:"2px"},onChange:function(e){return t.moveToFolder(e.target.value)}},React.createElement("option",{value:""},Q.text("Site.EmailClient.MoveToFolder")),this.props.flatFolderList.filter(function(e){return e.FullName!=t.props.folder}).map(function(t){return React.createElement("option",{key:t.FullName,value:t.FullName},e.mailboxFolderSelectPadding(t)+e.mailboxFolderName(t))}))," ",a&&React.createElement("button",{type:"button",className:"btn btn-danger btn-sm",onClick:function(e){return t.deleteMessage()}},React.createElement("i",{className:"fa fa-trash"})," ",Q.text("Site.EmailClient.DeleteButton"))),a&&React.createElement("div",{className:"mail-info"},React.createElement("div",{className:"date-from"},React.createElement("span",{className:"from"},this.state.message.From)," ",React.createElement("span",{className:"date"},this.getDateText())),React.createElement("div",{className:"subject"},this.state.message.Subject),React.createElement("div",{className:"to"},React.createElement("label",null,Q.text("Site.EmailClient.ToLabel"))," ",React.createElement("span",{className:"to"},this.state.message.To)),this.state.message.Cc&&React.createElement("div",{className:"cc"},React.createElement("label",null,Q.text("Site.EmailClient.CCLabel"))," ",React.createElement("span",{className:"cc"},this.state.message.Cc))),a&&React.createElement(e.HtmlIFrame,{src:"",className:"message-body",frameBorder:"0",contents:this.state.message.HtmlBody}),a&&!!this.state.message.Attachments&&!!this.state.message.Attachments.length&&React.createElement("div",{className:"attachments"},React.createElement("ul",null,this.state.message.Attachments.map(function(e){return React.createElement("li",null,React.createElement("a",{href:e.DownloadUrl,target:"_blank"},React.createElement("i",{className:"fa fa-file"})," ",e.FileName))}))))};return a}(React.Component);e.MailViewer=t})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){function t(e){var a=[];e=Q.coalesce(e,[]);for(var n=0,r=e;n<r.length;n++){var o=r[n];a.push(o);if(o.SubFolders&&o.SubFolders.length){for(var i=0,l=t(o.SubFolders);i<l.length;i++){var s=l[i];a.push(s)}}}return a}function a(e,t){t=t||[];for(var n=0,r=t;n<r.length;n++){var o=r[n];if(o.FullName==e)return o;if(o.SubFolders&&o.SubFolders.length){var i=a(e,o.SubFolders);if(i)return i}}return null}function n(e){if(!e)return{};if(e.charAt(0)=="#")e=e.substr(1);var t={};if(Q.startsWith(e,"folder/")){var a=e.substr("folder/".length);var n=a.lastIndexOf("/");t.msg=-1;if(n<a.length-1){t.msg=parseInt(a.substr(n+1),10);if(isNaN(t.msg)){t.msg=-1}else{a=a.substr(0,n)}}t.folder=decodeURIComponent(a)}return t}function r(e,t){return Q.formatDate(e,t||"yyyy-MM-dd HH:mm")}var o=function(o){__extends(i,o);function i(e,t){var a=o.call(this,e,t)||this;a.reloadTimeout=0;a.state={folder:"",folders:[],viewingMessage:-1,newMessages:0,messages:[],messageCount:0,page:0,pageSize:20,containsText:"",containsLock:0,showLogin:false};return a}i.prototype.loadMessages=function(){var t=this;e.EmailService.ListMessages({Folder:this.state.folder,Skip:this.state.page*this.state.pageSize,Take:this.state.pageSize,ContainsText:this.state.containsText},function(e){t.setState({messages:e.Entities||[],messageCount:e.TotalCount||0})},{onError:function(e){return t.serviceErrorHandler(e)}})};i.prototype.composeMessage=function(){(new e.EmailComposeDialog).dialogOpen()};i.prototype.serviceErrorHandler=function(e){if(e.Error&&e.Error.Code=="UnauthorizedAccess"){this.setState({showLogin:true})}else{Q.ErrorHandling.showServiceError(e.Error)}};i.prototype.initialLoadFolders=function(){var t=this;e.EmailService.ListFolders({},function(e){for(var a=0,r=e.Entities||[];a<r.length;a++){var o=r[a];if(o.FullName=="INBOX")$("#UnreadEmailCount").text(o.UnreadCount||0).toggle(o.UnreadCount>0)}var i;if(window.location.hash&&Q.startsWith(window.location.hash,"#folder/"))i=n(window.location.hash).folder;else i=t.state.folder||(t.state.folders[0]||{}).FullName||"INBOX";if(t.state.folder!==i){t.setState({folders:e.Entities||[],folder:i},function(){return t.loadMessages()})}else{t.setState({folders:e.Entities||[]})}},{onError:function(e){return t.serviceErrorHandler(e)}})};i.prototype.changeFolder=function(e){var t=this;this.setState({folder:e,page:0,containsText:""},function(){return t.loadMessages()})};i.prototype.changePage=function(e){var t=this;if(e<0)e=0;var a=Math.floor(Math.max(this.state.messageCount-1,0)/(this.state.pageSize||20));if(e>a)e=a;if(this.state.page!=e){this.setState({page:e},function(){return t.loadMessages()})}};i.prototype.setElement=function(e){var t=this;if(this.element)$(this.element.parentElement).removeClass("route-handler").off("handleroute");this.element=e;if(this.element){$(this.element).addClass("route-handler").on("handleroute",function(e,a){var r=a.route||"";if(Q.startsWith(r,"folder/")){a.handled=true;var o=n(r);var i=o.msg;var l=o.folder;if(t.state.folder!=l){t.setState({viewingMessage:-1},function(){return t.changeFolder(l)})}if(t.state.viewingMessage!=i){t.setState({viewingMessage:i});if(i>=0){var s=Q.tryFirst(t.state.messages||[],function(e){return e.UniqueId==i});if(s&&!s.Seen){t.toggleSeen(s)}}}}})}};i.prototype.componentDidMount=function(){this.initialLoadFolders();Q.Router.resolve()};i.prototype.activeFolderName=function(){if(!this.state.folder)return"";var t=a(this.state.folder,this.state.folders);if(!t)return"";return e.mailboxFolderName(t)};i.prototype.setContainsText=function(e){var t=this;if(e===this.state.containsText)return;this.setState({containsText:e});clearTimeout(this.reloadTimeout);this.reloadTimeout=window.setTimeout(function(){t.setState({page:0},function(){return t.loadMessages()})},500)};i.prototype.allChecked=function(){return this.state.messages.length&&!Q.any(this.state.messages,function(e){return!e.__checked})};i.prototype.checkAll=function(){var e=this.allChecked();this.setState({messages:this.state.messages.map(function(t){return $.extend({},t,{__checked:!e})})})};i.prototype.deleteSelected=function(){var t=this;var a=this.state.messages.filter(function(e){return e.__checked}).map(function(e){return e.UniqueId});if(!a.length){Q.notifyWarning(Q.text("Site.EmailClient.DeleteNoSelectionWarning"));return}Q.confirm(Q.format(Q.text("Site.EmailClient.DeleteSelectedConfirmation"),a.length),function(){e.EmailService.DeleteMessages({Folder:t.state.folder,UniqueIds:a},function(e){Q.notifyInfo(Q.text("Site.EmailClient.DeleteSelectedSuccess"));t.loadMessages()})})};i.prototype.moveToFolder=function(t,a){var n=this;if(!t)return;var r=a?[a]:this.state.messages.filter(function(e){return e.__checked});if(!r.length){Q.notifyWarning(Q.text("Site.EmailClient.MoveNoSelectionWarning"));return}e.EmailService.Move({SourceFolder:this.state.folder,UniqueIds:r.map(function(e){return e.UniqueId}),TargetFolder:t},function(e){Q.notifySuccess(Q.format(Q.text("Site.EmailClient.MoveSelectedSuccess"),r.length));n.loadMessages()})};i.prototype.getToolbarProps=function(){var e=this;return{allChecked:this.allChecked(),flatFolderList:t(this.state.folders),folder:this.state.folder,messageCount:this.state.messageCount,onChangePage:function(t){return e.changePage(t)},onCheckAll:function(){return e.checkAll()},onDelete:function(){return e.deleteSelected()},onMoveToFolder:function(t){return e.moveToFolder(t)},onRefresh:function(){return e.refreshMessages()},onToggleSeen:function(){e.toggleSeen()},page:this.state.page,pageSize:this.state.pageSize}};i.prototype.setChecked=function(e,t){if(!!e.__checked!==!!t){this.setState({messages:this.state.messages.map(function(a){return a===e?$.extend({},a,{__checked:!!t}):a})})}};i.prototype.toggleSeen=function(t){var n=this;var r=t?[t]:this.state.messages.filter(function(e){return e.__checked});if(!r.length){Q.notifyWarning(Q.text("Site.EmailClient.ToggleSeenNoSelectionWarning"));return}var o=Q.any(r,function(e){return!e.Seen});e.EmailService.ToggleSeen({Folder:this.state.folder,UniqueIds:r.map(function(e){return e.UniqueId}),Seen:o},function(e){var t=a(n.state.folder,n.state.folders);var i=t?t.UnreadCount||0:0;var l=n.state.messages.map(function(e){if(r.indexOf(e)<0||o==!!e.Seen)return e;if(t){i=Math.max(i+(o?-1:1),0);if(t.FullName=="INBOX")$("#UnreadEmailCount").text(i).toggle(i>0)}return $.extend({},e,{Seen:o})});var s=n.state.folders.map(function(e){if(e!==t)return e;return $.extend({},e,{UnreadCount:i})});n.setState({messages:l,folders:s})})};i.prototype.refreshMessages=function(){this.loadMessages()};i.prototype.signout=function(){var t=this;e.EmailService.Signout({},function(e){return t.setState({showLogin:true,folders:[],folder:""})})};i.prototype.render=function(){var t=this;if(this.state.showLogin)return React.createElement(e.MailboxLoginView,{onLogin:function(){return t.setState({showLogin:false,folders:[],folder:""},function(){return t.initialLoadFolders()})}});var a=this.getToolbarProps();return React.createElement("div",{ref:function(e){return t.setElement(e)},className:"s-MailboxView"},React.createElement("div",{className:"mailbox"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3"},React.createElement("a",{href:"javascript:;",className:"btn btn-primary btn-block margin-bottom",onClick:function(e){return t.composeMessage()}},React.createElement("i",{className:"fa fa-envelope-o"})," ",Q.text("Site.EmailClient.ComposeButton")),React.createElement("div",{className:"box box-solid"},React.createElement("div",{className:"box-header with-border"},React.createElement("h3",{className:"box-title"},Q.text("Site.EmailClient.FoldersTitle"))),React.createElement("div",{className:"box-body no-padding"},this.state.folders.map(function(a){return React.createElement("ul",{className:"nav nav-pills nav-stacked",key:a.FullName},React.createElement(e.MailboxFolderLink,{folder:a,activeFolder:t.state.folder}))}))),React.createElement("div",null,React.createElement("button",{className:"btn btn-small btn-danger pull-right",onClick:function(e){return t.signout()}},React.createElement("i",{className:"fa fa-sign-out"})," ",Q.text("Site.EmailClient.SignoutButton")))),React.createElement("div",{className:"col-md-9"},this.state.viewingMessage<0&&React.createElement("div",{className:"box box-primary"},React.createElement("div",{className:"box-header with-border"},React.createElement("h3",{className:"box-title"},this.activeFolderName()),React.createElement("div",{className:"box-tools pull-right"},React.createElement("div",{className:"has-feedback"},React.createElement("input",{type:"text",className:"form-control input-sm",placeholder:Q.text("Site.EmailClient.SearchPlaceholder"),value:this.state.containsText,onChange:function(e){return t.setContainsText(e.target.value)}}),React.createElement("span",{className:"glyphicon glyphicon-search form-control-feedback"})))),React.createElement("div",{className:"box-body no-padding"},React.createElement(e.MailboxToolbar,a),React.createElement("div",{className:"table-responsive mailbox-messages",style:{minHeight:"40px"}},React.createElement("table",{className:"table table-hover table-striped mail-table"},React.createElement("tbody",null,this.state.messages.map(function(e){return React.createElement("tr",{className:!e.Seen?"unseen":null,key:e.UniqueId},React.createElement("td",{className:"mailbox-check"},React.createElement("input",{type:"checkbox",checked:e.__checked,onClick:function(a){return t.setChecked(e,a.target.checked)}})),React.createElement("td",{className:"mailbox-star"},React.createElement("a",{href:"javascript:;",onClick:function(a){return t.toggleSeen(e)}},React.createElement("i",{className:"fa"+(!e.Seen?" fa-star":"")+(e.Seen?" fa-star-o":"")+" text-yellow"}))),React.createElement("td",{className:"mailbox-name"},React.createElement("div",null,React.createElement("a",{href:"#folder/"+encodeURIComponent(t.state.folder)+"/"+e.UniqueId},e.From))),React.createElement("td",{className:"mailbox-subject"},React.createElement("div",null,e.Subject)),React.createElement("td",{className:"mailbox-attachment"},!!e.HasAttachments&&React.createElement("i",{className:"fa fa-paperclip"})),React.createElement("td",{className:"mailbox-date"},React.createElement("div",null,r(e.Date))))}))))),React.createElement("div",{className:"box-footer no-padding"},React.createElement(e.MailboxToolbar,a))),this.state.viewingMessage>=0&&React.createElement("div",{className:"box box-primary"},React.createElement("div",{className:"box-body"},React.createElement(e.MailViewer,{folder:this.state.folder,uid:this.state.viewingMessage,onClose:function(){return t.refreshMessages()},flatFolderList:a.flatFolderList})))))))};return i}(React.Component);e.MailboxView=o})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var a=function(a){__extends(n,a);function n(e,n){var r=a.call(this,e,n)||this;e.attr("autocomplete","off");function o(e){return e.split(";")}function i(e){return o(e).pop()}e.autocomplete({minLength:0,source:function(e,a){t.EmailService.Suggest({ContainsText:i(e.term)},function(e){a(e.Suggestions)},{onError:function(e){a([])}})},focus:function(){return false},select:function(e,t){var a=o(this.value);a.pop();a.push(t.item.value);a.push("");this.value=a.join("; ");return false}});return r}n=__decorate([e.Decorators.registerEditor("Serenity.EmailClient.EmailSuggestEditor"),e.Decorators.element('<input type="text"/>')],n);return n}(e.Widget);t.EmailSuggestEditor=a})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var a=function(t){__extends(a,t);function a(e,a){return t.call(this,e,a)||this}a.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);e.extraPlugins=(e.extraPlugins?e.extraPlugins+",":"")+"uploadimage,image2";e.removePlugins=(e.removePlugins?e.removePlugins+",":"")+"elementspath";e.imageUploadUrl=Q.resolveUrl("~/File/TemporaryUploadCK");e.fullPage=true;e.allowedContent=true;return e};a=__decorate([e.Decorators.registerEditor("Serenity.EmailClient.EmailContentEditor")],a);return a}(e.HtmlContentEditor);t.EmailContentEditor=a})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var a=function(a){__extends(n,a);function n(){var e=a.call(this)||this;e.form=new t.EmailComposeForm(e.idPrefix);e.dialogTitle=Q.text("Site.EmailClient.NewEmailDialogTitle");return e}n.prototype.getFormKey=function(){return t.EmailComposeForm.formKey};Object.defineProperty(n.prototype,"reply",{get:function(){return this._reply},set:function(e){if(this._reply!=e){this._reply=e;if(this._reply){this.dialogTitle=Q.text("Site.EmailClient.ReplyEmailDialogTitle");this.form.To.element.val(this._reply.To);this.form.Cc.element.val(this._reply.Cc);this.form.Subject.value=this._reply.Subject;this.form.BodyHtml.value=this._reply.ReplyBody;if(this._reply.Attachments){this.form.Attachments.value=this._reply.Attachments.map(function(e){return{Filename:e.DownloadUrl,OriginalName:e.FileName}})}}}},enumerable:true,configurable:true});n.prototype.getDialogButtons=function(){var e=this;return[{text:Q.text("Site.EmailClient.SendButton"),click:function(){if(!e.validateForm())return;var a=e.getSaveEntity();t.EmailService.Compose(a,function(t){e.dialogClose()})}},{text:Q.text("Site.EmailClient.CancelButton"),click:function(){return e.dialogClose()}}]};n.prototype.getDialogOptions=function(){var e=a.prototype.getDialogOptions.call(this);e.width=960;return e};n=__decorate([e.Decorators.registerClass(),e.Decorators.maximizable()],n);return n}(e.PropertyDialog);t.EmailComposeDialog=a})(t=e.EmailClient||(e.EmailClient={}))})(Serenity||(Serenity={}));