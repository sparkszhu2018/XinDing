var Q;(function(e){function t(e,t){for(var r in t)e[r]=t[r];return e}e.extend=t;var r=0;function n(){var e="uid_"+ ++r+"_";return function(){var t=0;return function(){return e+ ++t}}}e.uidGenerator=n;var i={}.hasOwnProperty;function o(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=[];for(var n=0;n<arguments.length;n++){var a=arguments[n];if(!a)continue;var s=typeof a;if(s==="string"||s==="number"){r.push(a)}else if(Array.isArray(a)&&a.length){var l=o.apply(null,a);if(l){r.push(l)}}else if(s==="object"){for(var p in a){if(i.call(a,p)&&a[p]){r.push(p)}}}}return r.join(" ")}e.cssClass=o})(Q||(Q={}));var Q;(function(e){function t(e){return function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.render=function(){var e=this;return React.createElement("div",{ref:function(t){return e.wrapper=t},className:"widget-wrapper"})};r.prototype.componentWillReceiveProps=function(e){var t=this;var r=this.props;var n=this.widget;if(n==null||n.element==null)return;var i=n.element;var o=i[0];if(e.id!==r.id){o.id=e.id}if(e.name!==r.name&&i.is(":input")){o.name=e.name}if(e.placeholder!==r.placeholder&&i.is(":input")){o.placeholder=e.placeholder}if(e.className!==r.className){i.removeClass(r.className||"").addClass(e.className)}if(e.oneWay!==r.oneWay){o.dataset.oneWay=e.oneWay?"1":undefined}if(e.maxLength!=r.maxLength)o.setAttribute("maxLength",e.maxLength||0);if(e.required!==r.required)Serenity.EditorUtils.setRequired(this.widget,e.required);if(r.readOnly!==r.readOnly)Serenity.EditorUtils.setReadOnly(this.widget,e.readOnly);if(e.setOptions!=r.setOptions){Serenity.ReflectionOptionsSetter.set(this.widget,e.setOptions)}if(e.value!==r.value){Serenity.EditorUtils.setValue(this.widget,e.value)}if(e.onChange!==r.onChange){this.widget.element.off(".wcf");if(e.onChange)this.widget.element.on("change.wcf",e.onChange)}if(e.onChangeSelect2!==r.onChangeSelect2){this.widget.element.off(".wcf2");if(e.onChangeSelect2){this.widget.element.on("change.wcf2",function(e,r){if(!!(Serenity.WX.hasOriginalEvent(e)||!r)){t.props.onChangeSelect2&&t.props.onChangeSelect2(e)}})}}};r.prototype.componentDidMount=function(){if(this.widget!=null)return;var t=Serenity.Widget.elementFor(e);var r=t[0];this.wrapper.appendChild(r);var n=this.props;if(n.id!=null)r.id=n.id;if(t.is(":input")){t.addClass("editor");if(n.name!=null)r.name=n.name;if(n.placeholder!=null)r.placeholder=n.placeholder}if(n.className!=null)t.addClass(n.className);if(n.oneWay)r.dataset.oneWay="1";this.widget=new e(t,n);if(n.maxLength!=null)r.setAttribute("maxLength",n.maxLength.toString());if(n.required)Serenity.EditorUtils.setRequired(this.widget,true);if(n.readOnly)Serenity.EditorUtils.setReadOnly(this.widget,true);if(n.setOptions!=null){Serenity.ReflectionOptionsSetter.set(this.widget,n.setOptions)}if(n.value!==undefined)Serenity.EditorUtils.setValue(this.widget,n.value);else if(n.defaultValue!==undefined)Serenity.EditorUtils.setValue(this.widget,n.defaultValue);if(n.onChange!=null)this.widget.element.on("change.wcf",n.onChange);if(n.onChangeSelect2!=null){this.widget.element.on("change.wcf2",function(e,t){if(!!(Serenity.WX.hasOriginalEvent(e)||!t)){n.onChangeSelect2&&n.onChangeSelect2(e)}})}};r.prototype.componentWillUnmount=function(){this.widget&&this.widget.destroy();this.widget=null};r.prototype.shouldComponentUpdate=function(){return false};r.prototype.isWidgetWrapper=true;r.displayName="Wrapped<"+ss.getTypeFullName(e)+">";return r}(React.Component)}var r=React.createElement;React.createElement=function(){var e=arguments[0];if(typeof e==="function"&&e.__isWidgetType===true){if(e.__componentFactory===undefined)arguments[0]=e.__componentFactory=t(e);else arguments[0]=e.__componentFactory;if(arguments.length>1&&arguments[1]&&arguments[1].ref){var n=arguments[1].ref;arguments[1].ref=function(e){if(e==null)n(null);else n(e.widget)}}}return r.apply(this,arguments)}})(Q||(Q={}));var Serenity;(function(e){var t;(function(t){var r=function(){function t(e){this.inner=e;this.setters=Object.create(null);this.refs=Object.create(null);this.set=this.set.bind(this);this.setter=this.setter.bind(this)}t.prototype.get=function(e){return this.refs[e]};t.prototype.set=function(e,t){this.refs[e]=t;if(this.inner!=null)this.inner(e,t)};t.prototype.setter=function(e){var t=this.setters[e];if(t!=null)return t;var r=this.set;t=function(t){r(e,t)};this.setters[e]=t;return t};t.prototype.loadFrom=function(t,r){r=Q.coalesce(r,Object.keys(this.refs));for(var n=0,i=r;n<i.length;n++){var o=i[n];var a=this.refs[o];if(a==null)continue;if(a.isWidgetWrapper){a=a.widget;if(a)e.EditorUtils.loadValue(a,{name:o},t)}else if(a.nodeType){t[o]=a.value}else if(a.element){e.EditorUtils.loadValue(a,{name:o},t)}}};t.prototype.saveTo=function(t,r,n){r=Q.coalesce(r,Object.keys(this.refs));for(var i=0,o=r;i<o.length;i++){var a=o[i];var s=this.refs[a];if(s.isWidgetWrapper){if(n||!s.props.oneWay){s=s.widget;if(s)e.EditorUtils.saveValue(s,{name:a},t)}}else if(s.nodeType){if(n||!s.dataset||!s.dataset.oneWay)t[a]=s.value}else if(s.element){if(n||!s.options||!s.options.oneWay){e.EditorUtils.saveValue(s,{name:a},t)}}}};return t}();t.EditorRefs=r})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(){var e=this.props;var t=typeof e.width=="string"||e.width==null?null:typeof e.width=="number"?e.width+"px":e.width;var r=t==null?null:t=="0"?{display:"none"}:{width:t};return React.createElement("label",{className:"caption",htmlFor:e.htmlFor,title:e.hint,style:r},e.required&&React.createElement("sup",{title:Q.text("Controls.PropertyGrid.RequiredHint")},"*"),e.children)};return t}(React.Component);e.Label=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(){return React.createElement("div",{className:"vx"})};t.prototype.shouldComponentUpdate=function(){return false};return t}(React.Component);e.ValidationMark=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.componentWillReceiveProps=function(e,t){if(e!=null&&e.setRef!==this.props.setRef){this.editorRef=null}};r.prototype.render=function(){var t=this.props;var r;if(t.label!=null)r=t.label(this.props);else if(t.caption!==false){r=React.createElement(e.Label,{htmlFor:t.htmlFor===undefined?t.id:t.htmlFor,hint:t.hint,width:t.labelWidth,required:t.required},t.caption)}var n="field";if(t.name){n+=" "+t.name}if(t.className){n+=" "+t.className}var i=t.name;if(this.props.setRef!=null&&this.editorRef==null){var o=this.props.setRef;this.editorRef=function(e){o(i,e)}}var a={className:"editor",name:i,id:this.props.id,required:this.props.required,ref:this.editorRef};return React.createElement("div",{className:n},r,t.editor!=null&&t.editor(a),t.children,t.vx!==false&&React.createElement(e.ValidationMark,null),React.createElement("div",{className:"clear"}))};return r}(React.Component);e.Field=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var r=function(r){__extends(n,r);function n(){var e=r!==null&&r.apply(this,arguments)||this;e.text=Q.prefixedText(e.props.localTextPrefix);return e}n.prototype.getCaption=function(){return this.text(this.props.title,this.props.name)};n.prototype.getHint=function(){var e=this.text(this.props.hint,this.props.name+"_Hint");if(e==null)return this.getCaption();return e||null};n.prototype.getPlaceHolder=function(){return this.text(this.props.placeholder,this.props.name+"_Placeholder")};n.prototype.getClassName=function(){var e=this.props.cssClass||"";if(!Q.isEmptyOrNull(this.props.formCssClass)){e+=(e?" ":"")+this.props.formCssClass}return e};n.prototype.getHtmlFor=function(t){var r;if((t===e.RadioButtonEditor||t===e.BooleanEditor)&&(this.props.editorParams==null||!!!this.props.editorParams["labelFor"])){r=null}return r};n.prototype.getEditorType=function(){if(this.props.editorType==null)return e.StringEditor;if(typeof this.props.editorType=="string")return e.EditorTypeRegistry.get(this.props.editorType);return this.props.editorType};n.prototype.getEditorId=function(){return(this.props.idPrefix||"")+(this.props.name||"")};n.prototype.getMaxLength=function(){return this.props.maxLength>0?this.props.maxLength:null};n.prototype.render=function(){var e=this;var r=this.getEditorType();return React.createElement(t.Field,{className:this.getClassName(),caption:this.getCaption(),id:this.getEditorId(),name:this.props.name,labelWidth:this.props.labelWidth,htmlFor:this.getHtmlFor(r),hint:this.getHint(),required:this.props.required,setRef:this.props.setRef,editor:function(t){return React.createElement(r,__assign({},t,{maxlength:e.getMaxLength()},e.props.editorParams,{setOptions:e.props.editorParams}))}},this.props.children)};return n}(React.Component);t.PropertyField=r})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(){return React.createElement("div",{className:"category-title",onClick:this.props.onClick},React.createElement("a",{className:"category-anchor",id:this.props.categoryId},this.props.children),this.props.collapsed!=null&&(this.props.collapsed?t.collapsedIcon:t.expandedIcon))};t.collapsedIcon=React.createElement("i",{className:"fa fa-plus"});t.expandedIcon=React.createElement("i",{className:"fa fa-minus"});return t}(React.Component);e.CategoryTitle=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getBreakClass=function(){var e="line-break";var t=this.props.breakClass.split(" ");if(t.indexOf("line-break-xs")>=0){}else if(t.indexOf("line-break-sm")>=0){e+=" hidden-xs"}else if(t.indexOf("line-break-md")>=0){e+=" hidden-sm"}else if(t.indexOf("line-break-lg")>=0){e+=" hidden-md"}return e};t.prototype.render=function(){return React.createElement("div",{className:this.getBreakClass(),style:{width:"100%"}})};return t}(React.Component);e.CategoryLineBreak=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.handleClick=function(e){e.preventDefault();this.props.onClick&&this.props.onClick(e);var t=$("a[id="+this.props.categoryId+"]");var r=t.closest(".category");if(r.hasClass("collapsed"))r.children(".category-title").click();if(!t&&!t.fadeTo)return;var n=function(){t.fadeTo(100,.5,function(){t.fadeTo(100,1,function(){})})};if(r.closest(":scrollable(both)").length===0)n();else{var i=r.scrollintoview;i&&i.scrollintoview({duration:"fast",direction:"y",complete:n})}};t.prototype.getLink=function(){if(Q.isEmptyOrNull(this.props.categoryId))return null;return"#"+this.props.categoryId};t.prototype.render=function(){var e=this;return React.createElement("a",{className:"category-link",tabIndex:-1,onClick:function(t){return e.handleClick(t)},href:this.getLink()},this.props.children)};return t}(React.Component);e.CategoryLink=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(t){__extends(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.text=Q.prefixedText(e.props.localTextPrefix);return e}r.prototype.renderSeparator=function(e){return React.createElement("span",{className:"separator",key:e},"|")};r.prototype.render=function(){var t=this;var r=e.Categories.groupByCategory(this.props.items);return React.createElement("div",{className:"category-links"},r.inOrder.map(function(r,n){return[n>0&&t.renderSeparator("sep-"+n),React.createElement(e.CategoryLink,{categoryId:"Category"+r.order,key:n},t.text(r.key,"Categories."+r.key))]}))};return r}(React.Component);e.CategoryLinks=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(t){__extends(r,t);function r(e,r){var n=t.call(this,e,r)||this;n.text=Q.prefixedText(n.props.localTextPrefix);n.state={collapsed:n.props.collapsed};return n}r.prototype.componentWillReceiveProps=function(e){if(e.collapsed!==this.props.collapsed){this.setState({collapsed:e.collapsed})}};r.prototype.getClassName=function(){if(this.state.collapsed==null)return"category ";if(this.state.collapsed==true)return"category collapsible collapsed";return"category collapsible"};r.prototype.getCategoryId=function(){if(!this.props.categoryId)return null;return Q.coalesce(this.props.idPrefix,"")+this.props.categoryId};r.prototype.handleTitleClick=function(){if(this.state.collapsed==null)return;this.setState({collapsed:!this.state.collapsed})};r.prototype.renderTitle=function(){var t=this;if(this.props.category==null)return null;return React.createElement(e.CategoryTitle,{categoryId:this.getCategoryId(),collapsed:this.state.collapsed,onClick:function(){return t.handleTitleClick()}},this.text(this.props.category,"Categories."+this.props.category))};r.prototype.renderField=function(t){var r=Q.extend({idPrefix:this.props.idPrefix,localTextPrefix:this.props.localTextPrefix,key:t.name,setRef:this.props.setRef},t);if(this.props.renderField!=null){var n=this.props.renderField(r);if(n!==undefined)return n}return React.createElement(e.PropertyField,r)};r.prototype.renderWithBreak=function(t){return[React.createElement(e.CategoryLineBreak,{breakClass:t.formCssClass,key:"break-"+t.name}),this.renderField(t)]};r.prototype.render=function(){var e=this;var t=this.props;return React.createElement("div",{className:this.getClassName()},this.renderTitle(),t.items&&t.items.map(function(t){if(t.formCssClass&&t.formCssClass.indexOf("line-break-")>=0)return e.renderWithBreak(t);return e.renderField(t)}),t.children)};return r}(React.Component);e.Category=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(){function e(){}return e}();e.CategoriesProps=t;var r=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.applyOrder=function(e,t){if(!t)return;var r=t.split(";");var n=0;var i={};for(var o=0,a=r;o<a.length;o++){var s=a[o];var l=Q.trimToNull(s);if(l==null||i[l]!=null)continue;i[l]=n++}e.inOrder.sort(function(e,t){var r=i[e.key];if(r==null)i[e.key]=i=n++;var o=i[t.key];if(o==null)i[t.key]=i=n++;return r-o});for(n=0;n<e.inOrder.length;n++)e.inOrder[n].order=n};r.groupByCategory=function(e,t,n){var i=Q.coalesce(t,"");var o=Q.groupBy(e||[],function(e){return Q.coalesce(e.category,i)});r.applyOrder(o,n);return o};r.prototype.renderCategory=function(t){var r={categoryId:"Category"+t.order,category:t.key,idPrefix:this.props.idPrefix,localTextPrefix:this.props.localTextPrefix,items:t.items,key:t.order,renderField:this.props.renderField,setRef:this.props.setRef};if(this.props.renderCategory!=null){var n=this.props.renderCategory(r);if(n!==undefined)return n}return React.createElement(e.Category,__assign({},r))};r.prototype.render=function(){var e=this;return React.createElement("div",{className:"categories"},r.groupByCategory(this.props.items||[],this.props.defaultCategory,this.props.categoryOrder).inOrder.map(function(t){return e.renderCategory(t)}))};return r}(React.Component);e.Categories=r})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var r=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.render=function(){var e=this;var t=this.props,r=t.options,n=__rest(t,["options"]);return React.createElement("form",__assign({},n,{ref:function(t){e.form=t},onSubmit:this.props.onSubmit||function(t){return e.handleSubmit(t)}}),this.props.children)};r.prototype.handleSubmit=function(e){if(!this.validator.valid())return false};r.prototype.componentDidMount=function(){this.validator=$(this.form).validate(Q.validateOptions(this.props.options))};r.prototype.validateForm=function(){return this.validator==null||!!this.validator.form()};r.prototype.serialize=function(){var t={};$(this.form).find(":input, .editor").each(function(r,n){var i=$(n).attr("name");if(!i)return;var o=$(n).tryGetWidget(e.Widget);if(o)t[i]=e.EditorUtils.getValue(o);else t[i]=$(n).val()});return t};return r}(React.Component);t.ValidateForm=r})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(){return React.createElement("div",{className:"flex-layout"},React.createElement("div",{className:"s-Form"},e.prototype.render.call(this)))};return t}(e.ValidateForm);e.Form=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(t){__extends(r,t);function r(){var e=t!==null&&t.apply(this,arguments)||this;e.text=Q.prefixedText(e.props.localTextPrefix);return e}r.groupByTab=function(e){return Q.groupBy(e||[],function(e){return Q.coalesce(e.tab,"")})};r.prototype.renderTab=function(e){return React.createElement("li",{className:e.order==0?"active":null,key:e.order},React.createElement("a",{"data-toggle":"tab",role:"tab",href:"#"+this.props.idPrefix+"_Tab"+e.order},this.text(e.key,"Tabs."+e.key)))};r.prototype.renderPane=function(e){return React.createElement("div",{id:this.props.idPrefix+"_Tab"+e.order,key:e.order,className:"tab-pane fade"+(e.order==0?" in active":""),role:"tabpanel"},this.renderCategories(e))};r.prototype.renderCategories=function(t){var r={items:t.items,idPrefix:this.props.idPrefix,localTextPrefix:this.props.localTextPrefix,categoryOrder:this.props.categoryOrder,defaultCategory:this.props.defaultCategory,renderCategory:this.props.renderCategory,renderField:this.props.renderField,setRef:this.props.setRef};if(this.props.renderCategories){var n=this.props.renderCategories(t.key,r);if(n!==undefined)return n}return React.createElement(e.Categories,__assign({},r))};r.prototype.render=function(){var e=this;var t=r.groupByTab(this.props.items||[]);return React.createElement(React.Fragment,null,React.createElement("ul",{className:"nav nav-tabs property-tabs",role:"tablist"},t.inOrder.map(function(t){return e.renderTab(t)})),React.createElement("div",{className:"tab-content property-panes"},t.inOrder.map(function(t){return e.renderPane(t)})))};return r}(React.Component);e.PropertyTabs=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.loadFrom=function(e,t){var r=this.props.items||[];for(var n=0,i=r;n<i.length;n++){var o=i[n];if(this.props.mode!=2&&o.defaultValue!=null&&typeof e[o.name]==="undefined"){e[o.name]=o.defaultValue}}t.loadFrom(e,r.map(function(e){return e.name}))};r.prototype.canModifyItem=function(e){if(this.props.mode!=2){if(e.insertable===false){return false}if(e.insertPermission==null){return true}return Q.Authorization.hasPermission(e.insertPermission)}if(e.updatable===false){return false}if(e.updatePermission==null){return true}return Q.Authorization.hasPermission(e.updatePermission)};r.prototype.saveTo=function(e,t){t.saveTo(e)};r.prototype.getItems=function(){var e=this;return(this.props.items||[]).map(function(t){var r=e.canModifyItem(t);var n=!!t.oneWay||!r;var i=t.readOnly===true||!r;var o=!i&&!!t.required&&t.editorType!=="Boolean";var a=!(t.readPermission!=null&&!Q.Authorization.hasPermission(t.readPermission)||t.visible===false||e.props.mode!=2&&t.hideOnInsert===true||e.props.mode==2&&t.hideOnUpdate===true);return Q.extend(Q.extend({},t),{readOnly:i,oneWay:n,required:o,visible:a})})};r.prototype.render=function(){var t=Q.extend({},this.props);t.items=this.getItems();var r=Q.any(t.items,function(e){return!Q.isEmptyOrNull(e.tab)});if(r)return React.createElement(e.PropertyTabs,t);var n=t.useCategories!==false&&Q.any(t.items,function(e){return!Q.isEmptyOrNull(e.category)});if(n){React.createElement(React.Fragment,null,React.createElement(e.CategoryLinks,t),React.createElement(e.Categories,t))}return React.createElement("div",{className:"categories"},React.createElement(e.Category,t))};return r}(React.Component);e.IntraPropertyGrid=t;var r=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(){return React.createElement("div",{className:"s-PropertyGrid"},e.prototype.render.call(this))};return t}(t);e.PropertyGrid=r})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.render=function(){return React.createElement("div",{className:"align-right",style:{marginTop:"10px",paddingRight:"24px"}},this.props.children)};return t}(React.Component);e.ButtonPanel=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var r=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}n=r;r.adjustIconClass=function(e){if(!e)return e;if(Q.startsWith(e,"fa-"))return"fa "+e;if(Q.startsWith(e,"glyphicon-"))return"glyphicon "+e;return e};r.className=function(e){var t;return Q.cssClass((t={"tool-button":true,"icon-tool-button":!!e.icon,"no-text":!e.title,disabled:e.disabled},t[e.cssClass]=!!e.cssClass,t))};r.prototype.handleClick=function(e){if(!this.props.onClick||$(e.currentTarget).hasClass("disabled"))return;this.props.onClick(e)};r.prototype.render=function(){var e=this;return React.createElement("div",{className:n.className(this.props),title:this.props.hint,onClick:function(t){return e.handleClick(t)}},React.createElement("div",{className:"button-outer"},this.renderButtonText()))};r.prototype.renderButtonText=function(){var e=this.props;var t=n.adjustIconClass(e.icon);if(!t&&!e.title)return React.createElement("span",{className:"button-inner"});var r=Q.coalesce(e.title,"");if(e.htmlEncode===false){var i=(t?'<i class="'+Q.attrEncode(t)+'"></i> ':"")+r;return React.createElement("span",{className:"button-inner",dangerouslySetInnerHTML:{__html:i}})}if(!t)return React.createElement("span",{className:"button-inner"},r);return React.createElement("span",{className:"button-inner"},React.createElement("i",{className:t})," ",r)};var n;r.buttonSelector="div.tool-button";r=n=__decorate([e.Decorators.registerClass("Serenity.UI.ToolButton")],r);return r}(React.Component);t.ToolButton=r;var n=function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.setupMouseTrap=function(){var e=this;if(!window["Mousetrap"])return;var r;for(var n=0,i=this.props.buttons||[];n<i.length;n++){var o=i[n];if(Q.isEmptyOrNull(o.hotkey))continue;this.mouseTrap=this.mouseTrap||window["Mousetrap"](this.props.hotkeyContext||window.document.documentElement);(function(n){var i=(r=r||$(e.el).find(t.ToolButton.buttonSelector)).filter("."+n.cssClass);e.mouseTrap.bind(n.hotkey,function(e,t){if(i.is(":visible")){i.click()}return n.hotkeyAllowDefault})})(o)}};r.prototype.componentDidMount=function(){this.setupMouseTrap()};r.prototype.componentWillUnmount=function(){$(this.el).find(t.ToolButton.buttonSelector).unbind("click");if(this.mouseTrap){if(!!this.mouseTrap.destroy){this.mouseTrap.destroy()}else{this.mouseTrap.reset()}this.mouseTrap=null}};r.prototype.render=function(){var e=this;return React.createElement("div",{className:"tool-buttons",ref:function(t){return e.el=t}},React.createElement("div",{className:"buttons-outer"},this.renderButtons(this.props.buttons||[])))};r.prototype.renderButtons=function(e){var r=[];for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.separator)r.push(React.createElement("div",{className:"separator",key:r.length}));r.push(React.createElement(t.ToolButton,__assign({},o,{key:r.length})))}var a=0;return React.createElement("div",{className:"buttons-inner"},r.map(function(e){e.key=++a;return e}),this.props.children)};return r}(React.Component);t.IntraToolbar=n;var i=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.render=function(){return React.createElement("div",{className:"s-Toolbar clearfix"},t.prototype.render.call(this))};r=__decorate([e.Decorators.registerClass("Serenity.UI.Toolbar")],r);return r}(n);t.Toolbar=i})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.render=function(){var t=Q.text("Controls.EntityDialog."+(this.props.isUpdate?"UpdateButton":"SaveButton"));return React.createElement(e.ToolButton,__assign({icon:"fa-save text-light-blue",title:t},this.props))};return r}(React.Component);e.SaveButton=t;var r=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.render=function(){var t=Q.text("Controls.EntityDialog.ApplyChangesButton");return React.createElement(e.ToolButton,__assign({icon:"fa-save",cssClass:"text-black",hint:t},this.props))};return r}(React.Component);e.ApplyChangesButton=r;var n=function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.render=function(){var t=Q.text("Controls.EntityDialog.DeleteButton");return React.createElement(e.ToolButton,__assign({icon:"fa-times text-red",title:t},this.props))};return r}(React.Component);e.DeleteButton=n})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t;(function(e){e[e["Initial"]=0]="Initial";e[e["New"]=1]="New";e[e["Edit"]=2]="Edit";e[e["View"]=3]="View";e[e["Deleted"]=4]="Deleted"})(t=e.FormMode||(e.FormMode={}))})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var r=function(r){__extends(n,r);function n(e,t){var n=r.call(this,e,t)||this;n.emptyEntity=Object.create(null);var i=n.props.entity;var o=n.modeFor(i);n.state={formMode:o,formTitle:n.titleFor(i,o),entity:i};if(n.props.entityId!=null)n.loadById(n.props.entityId);n.delete=n.delete.bind(n);n.save=n.save.bind(n);return n}n.prototype.componentWillReceiveProps=function(e){var t=Q.coalesce(e.entityId,null);var r=Q.coalesce(this.props.entityId,null);if(t!==r){if(t===null){this.loadEntity(e.entity||Object.create(null))}else{this.loadById(e.entityId)}}else if(e.entity!==this.props.entity){this.loadEntity(Q.coalesce(e.entity,Object.create(null)))}};n.prototype.componentDidMount=function(){this.canSetState=true;if(this.pendingEntity!==undefined){this.loadEntity(this.pendingEntity||Object.create(null))}};n.prototype.componentWillUnmount=function(){this.canSetState=false};n.prototype.loadEntity=function(e){if(this.canSetState){var t=this.modeFor(e);this.setState({formMode:t,formTitle:this.titleFor(e,t),entity:e});this.pendingEntity=undefined}else{this.pendingEntity=e||null}};n.prototype.loadResponse=function(e){this.loadEntity(e.Entity)};n.prototype.getLoadByIdRequest=function(e){return{EntityId:e}};n.prototype.getServiceFor=function(e){var t=this.props[e.charAt(0).toLowerCase()+e.substr(1)+"Service"];if(t!=null)return t;return(this.props.service||"ServiceNotSet!")+"/"+e};n.prototype.getLoadByIdOptions=function(e){return{service:this.getServiceFor("Retrieve"),request:this.getLoadByIdRequest(e)}};n.prototype.loadById=function(e){var t=this;var r=this.getLoadByIdOptions(e);return Q.serviceCall(r).then(function(e){t.loadResponse(e);return e})};n.prototype.isDeleted=function(e){if(this.props.isDeletedProperty&&e[this.props.isDeletedProperty])return true;if(this.props.isActiveProperty&&e[this.props.isActiveProperty]===-1)return true};n.prototype.modeFor=function(e){if(e==null)return t.FormMode.Initial;if(this.props.readOnly)return t.FormMode.View;if(this.props.idProperty&&e[this.props.idProperty]!=null)return t.FormMode.Edit;if(this.isDeleted(e))return t.FormMode.Deleted;return t.FormMode.New};n.prototype.getEntityName=function(){if(this.props.localTextPrefix){var e=Q.tryGetText("Db."+this.props.localTextPrefix+".EntitySingular");if(e)return e}return"Item"};n.prototype.getNameValue=function(e){if(!e||!this.props.nameProperty)return"";return Q.coalesce(e[this.props.nameProperty],"").toString()};n.prototype.titleFor=function(e,r){if(r==t.FormMode.New)return Q.format(Q.text("Controls.EntityDialog.NewRecordTitle"),this.getEntityName());var n=Q.coalesce(this.getNameValue(e),"");return Q.format(Q.text("Controls.EntityDialog.EditRecordTitle"),this.getEntityName(),Q.isEmptyOrNull(n)?"":" ("+n+")")};n.prototype.isEditMode=function(){return this.state.formMode==t.FormMode.Edit};n.prototype.getSaveEntity=function(e){return e};n.prototype.getSaveOptions=function(e){var t={};t.service=this.getServiceFor(this.isEditMode()?"Update":"Create");t.request=this.getSaveRequest(e);return t};n.prototype.getIdProperty=function(){return this.props.idProperty||"NoIdProperty!"};n.prototype.getLanguages=function(){if(e.EntityDialog.defaultLanguageList!=null)return e.EntityDialog.defaultLanguageList()||[];return[]};n.prototype.getPendingLocalizations=function(){if(this.state.localizations==null){return null}var e={};var t=this.getIdProperty();var r=this.getLanguages();for(var n=0,i=r;n<i.length;n++){var o=i[n];var a=o[0];var s={};if(t!=null){s[t]=this.entity[this.getIdProperty()]}var l=a+"$";for(var p=0,u=Object.keys(this.state.localizations);p<u.length;p++){var c=u[p];if(Q.startsWith(c,l))s[c.substr(l.length)]=this.state.localizations[c]}e[a]=s}return e};n.prototype.getSaveRequest=function(e){var t=this.getSaveEntity(e);var r={};r.Entity=t;if(this.isEditMode()){var n=this.getIdProperty();if(n!=null){r.EntityId=this.entity[this.props.idProperty]}}if(this.state.localizations!=null){r.Localizations=this.getPendingLocalizations()}return r};n.prototype.save=function(e){var t=this.getSaveOptions(e);return Q.serviceCall(t)};n.prototype.delete=function(){return null};n.prototype.undelete=function(){return null};n.prototype.getDataModel=function(){return{entity:this.state.entity||this.emptyEntity,formMode:this.state.formMode,formTitle:this.state.formTitle,onSave:this.state.formMode==t.FormMode.Edit||this.state.formMode==t.FormMode.New?this.save:null,onDelete:this.state.formMode==t.FormMode.Edit?this.delete:null,onUndelete:this.state.formMode==t.FormMode.Deleted?this.undelete:null}};Object.defineProperty(n.prototype,"dataModel",{get:function(){return this.getDataModel()},enumerable:true,configurable:true});Object.defineProperty(n.prototype,"entity",{get:function(){return this.pendingEntity!==undefined?this.pendingEntity:this.state.entity},enumerable:true,configurable:true});n.prototype.render=function(){return this.props.view(this.getDataModel())};return n}(React.Component);t.FormDataSource=r})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(e){var t=function(t){__extends(r,t);function r(){var r=t!==null&&t.apply(this,arguments)||this;r.editors=new e.EditorRefs;return r}r.prototype.canSave=function(){return this.props.onSave!=null};r.prototype.showSave=function(){return this.props.formMode==e.FormMode.Edit||this.props.formMode==e.FormMode.New};r.prototype.canClose=function(){return this.props.onClose!=null};r.prototype.showApplyChanges=function(){return this.showSave()&&this.canClose()};r.prototype.isUpdate=function(){return this.props.formMode==e.FormMode.Edit};r.prototype.canDelete=function(){return this.props.onDelete!=null};r.prototype.showDelete=function(){return this.props.formMode==e.FormMode.Edit};r.prototype.canUndelete=function(){return this.props.onUndelete!=null};r.prototype.showUndelete=function(){return this.props.formMode==e.FormMode.Deleted};r.prototype.loadEntity=function(e){this.editors.loadFrom(e)
};r.prototype.componentDidMount=function(){this.loadEntity(this.props.entity||Object.create(null))};r.prototype.componentWillReceiveProps=function(e){if(e.entity!==null&&this.props.entity!==e.entity){this.loadEntity(e.entity||Object.create(null))}};r.prototype.renderSaveButton=function(){var t=this;return React.createElement(e.SaveButton,{isUpdate:this.isUpdate(),disabled:!this.canSave(),onClick:function(){return t.save(true)}})};r.prototype.renderApplyChangesButton=function(){var t=this;return React.createElement(e.ApplyChangesButton,{disabled:!this.canSave(),onClick:function(){return t.save(false)}})};r.prototype.renderDeleteButton=function(){return React.createElement(e.DeleteButton,{disabled:!this.canDelete()})};r.prototype.renderToolbar=function(t){return React.createElement(e.Toolbar,null,this.showSave()&&this.renderSaveButton(),this.showApplyChanges()&&this.renderApplyChangesButton(),this.showDelete()&&this.renderDeleteButton(),t)};r.prototype.save=function(e){var t=this;if(this.props.onSave==null)return Promise.reject("No onSave handler!");var r=Object.create(null);this.editors.saveTo(r);var n=this.props.onSave(r);if(e){if(this.props.onClose!=null)n=n.then(function(e){return t.props.onClose!=null&&t.props.onClose()})}else if(this.props.onReload!=null){n=n.then(function(e){return t.props.onReload!=null&&t.props.onReload()})}return n};return r}(React.Component);e.FormView=t})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));var Serenity;(function(e){var t;(function(t){var r=function(e){__extends(t,e);function t(t){var r=e.call(this,t)||this;r.mountView();return r}t.prototype.loadByIdAndOpenDialog=function(e,t){this.entityId=e;this.dialogOpen(t);this.mountView()};t.prototype.loadEntityAndOpenDialog=function(e,t){this.entityId=null;this.entity=e;this.dialogOpen(t);this.mountView()};t.prototype.loadNewAndOpenDialog=function(e){this.entityId=null;this.entity={};this.dialogOpen(e);this.mountView()};t.prototype.mountView=function(){if(!this.element||!this.element.length)return;var e=Q.extend({},this.options);this.view=ReactDOM.render(this.render(),this.element[0])};t.prototype.getTemplate=function(){return'<div class="s-DialogContent"></div>'};return t}(e.TemplatedDialog);t.Dialog=r})(t=e.UI||(e.UI={}))})(Serenity||(Serenity={}));